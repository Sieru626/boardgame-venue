# ボードゲーム会場 フェーズまとめ（NotebookLM用）

## 前提

- **プロジェクト**: Board Game Venue（ボドゲ会場）
- **リポジトリ**: [Sieru626/boardgame-venue](https://github.com/Sieru626/boardgame-venue)
- **本番**: Render（Auto-Deploy = main に push で自動反映）
- **技術**: Next.js (client), Express + Socket.io (server), Prisma + SQLite, Gemini API（APIキーでサーバーから利用）

---

## Phase 2.5 完了時点（現状）

- ミックスジュースが安定してプレイ可能。
- ターン・ラウンド結果（1位だけWIN表示）、チェンジ操作、手札パネル開閉、先攻ランダム化を実装済み。
- デプロイは「main に push するだけ」。Render のブランチは **main** に設定済み。
- バージョン表記は画面上で小さなバッジ表示に変更済み（邪魔にならない）。

---

## Phase 3: ソロ検証環境とAI演出

### Phase 3-1: CPU (Bot) の実装

**目的**: 1人でもミックスジュースを回して検証できるようにする。

- **対象ファイル**: `server/index.js`（Bot ロジックはまずここに集約）、クライアントは `client/app/room/[id]/page.tsx` および `UnifiedTable.tsx` のホスト用UI。
- **やること**:
  1. プレイヤーに `isBot`, `cpuLevel: 'weak' | 'normal' | 'strong'` を追加。
  2. `add_bot` イベントで Bot をルームに参加させる（ID は `bot-${timestamp}-${random}` など）。
  3. Bot 用の思考ロジック（弱い＝ランダム、普通＝0を捨てる・7以上ならパス寄り、強い＝枠だけ）。
  4. ターンが Bot に回ったら 2 秒後に自動で `mixjuice_action` 相当を実行するフック。
  5. ホスト用UIに「CPU追加（弱い）」「CPU追加（普通）」ボタンを追加。
- **制約**: 新規ファイルは作らず、まず `server/index.js` 内で完結。動作確認を優先。

**将来の拡張**:
- ゲームテンプレに応じて「このゲームはCPUを作る／作らない」をタグで判定。
- 自動で合法手＋評価関数を生成し、破綻検知（終わらない・必ず負ける等）まで回す「自動CPU」は後のフェーズで検討。

---

### Phase 3-2: AIディーラー（Dealer Bunny）

**目的**: カジノディーラー風のキャラで進行実況とルールQ&Aを提供する。

- **ペルソナ**: 名前「Dealer Bunny」、丁寧で少し遊び心のある口調（「〜ですわ」「〜しましょう」等）。
- **機能**:
  - **ルールQ&A**: チャットで `@GM` または `@Dealer` とメンションしたら、`docs/ボドゲ ミックスジュース.txt` を読ませた Gemini で返信。
  - **ゲーム実況**: ラウンド開始・0ドボン・勝利時などに、固定セリフまたは軽い生成テキストをチャットに自動投稿。
- **UI**: 立ち絵は v0 等でデザイン刷新するまで、チャット欄の名前・アイコンで表現。将来的に立ち絵＋吹き出しを追加。
- **優先度**: Phase 3-1（CPU）が動いてから統合。

---

## タグ設計（ゲームの種類をわかりやすくする）

**方針**: 人間には **日本語のわかりやすいタグ** を表示し、システムは **内部フラグ** で「CPU要否」「自動テスト対象」などを判定する。

- **表示用タグ（例・日本語）**  
  ゲーム性: `正体隠匿`, `協力`, `対戦`, `トリックテイキング`, `セットコレクション`  
  進行スタイル: `トーク系`, `カードゲーム`, `ボード配置`  
  人数・テンポ: `2人用`, `3〜6人`, `短時間`, `じっくり`

- **内部用（システム判定）**  
  - CPU を作るゲーム: ターン制カードゲームなど → 例: `requiresTurnBot`  
  - CPU を作らないゲーム: ディストピア家族会議のような「しゃべり中心」→ 例: `noBot` / `talkOnly`  
  - 自動プレイテスト対象: `supportsAutoPlaytest`  
  - 勝敗に人間の裁定が必要: `needsHumanJudge`

テンプレのメタには `tagsDisplay: string[]`（表示用）と `tagsInternal: string[]` または `flags` を持たせ、一覧・フィルタ・CPU生成の有無は内部タグで制御する。

---

## ゲーム種別とCPUの扱い

- **CPU が必要なゲーム**: ミックスジュースのように「手番で明確な行動（カードを出す等）」があるターン制ゲーム。→ 汎用「ターン制カード用CPU」を拡張して対応。
- **CPU がいらないゲーム**: ディストピア家族会議のように発言・ロールプレイ中心の「トーク系」。→ CPU は作らず、モデレーターや会話AIで補う。
- **将来**: テンプレから「合法手＋評価」を自動生成し、自動でプレイテスト・破綻検知（終わらない／必ず負ける等）を回す仕組みを、タグ（例: `supportsAutoPlaytest`）と組み合わせて検討。

---

## Gemini（APIキー）の扱い

- すべて **サーバー側** で `GEMINI_API_KEY` を読み、クライアントには渡さない。
- ローカル: `server/.env` に `GEMINI_API_KEY=...` を設定。
- 本番（Render）: サービスの Environment に `GEMINI_API_KEY` を追加。
- 用途: AIディーラーのルールQ&A・実況コメント、将来のモデレーターや会話AIなど。

---

## ドキュメント・参照

- ローカル起動・デプロイ: `README.md`, `docs/DEPLOY.md`
- ミックスジュースルール: `docs/ボドゲ ミックスジュース.txt`
- 開発メモ・現状まとめ: ノートまたは `docs/` 内の各 md

---

*このファイルは NotebookLM 等に送るためのフェーズまとめです。実装の細部はコードと Issue を参照してください。*
