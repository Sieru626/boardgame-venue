# Phase 4 検証手順書 (Safe AI Integration)

AI機能を「HTTP API (Safe Mode)」として再実装しました。
以下の手順で、機能が正常に動作し、かつサーバーが安定していることを確認してください。

## 1. 事前準備
*   **Server**: `localhost:3010` で起動中であることを確認。
*   **Client**: `localhost:3000` で起動中であることを確認。
*   **ブラウザ**: `http://localhost:3000` を開く。

## 2. AIチャットのテスト
無限ループせず、個別（ローカル）に回答が返ってくるか確認します。
1.  **GMタブ**を開く。
2.  適当な質問を入力する (例: 「このゲームのルールを教えて」)。
3.  **確認点**:
    *   [ ] 送信直後、自分の画面にだけ「Thinking...」が出る。
    *   [ ] 数秒後にAIからの返信が表示される。
    *   [ ] **重要**: 他のブラウザタブ（もし開いていれば）には**何も表示されない**はずです（ローカル仕様のため）。
    *   [ ] サーバーのログに大量の `state_update` が流れていないこと。

## 3. デッキ生成のテスト
サーバーの状態を書き換えず、まずはローカルで生成されるか確認します。
1.  **HOSTタブ**を開く。
2.  「AIデッキ生成」欄にテーマを入力 (例: 「炎の魔法使い」)。
3.  「生成」ボタンを押す。
4.  **確認点**:
    *   [ ] ボタンが「...」になり、他の操作をロックしない。
    *   [ ] 数秒後、上のリストにカードが生成される。
    *   [ ] この時点では、まだゲーム内の「山札」や「ログ」には反映されていないはずです。
5.  **反映テスト (修正済み)**:
    *   「山札へ反映」を押す。
    *   [ ] ログに「Deck Updated (X cards)」と表示される。
    *   [ ] 画面の山札の枚数が更新される。
    *   [ ] カードを引くと、生成したカード（またはトランプ）が出てくる。

## 3.5. 既存ゲームモードの編集テスト (Bug Fix Verification)
1.  **Game Library**から「ディストピア家族会議」などを選択し「Apply」。
2.  **Deck / Rule**ボタン（デッキ編集）を開く。
3.  **確認点**:
    *   [ ] カードリストが空ではなく、初期カード（シーン・条例など）が表示されていること。
    *   [ ] リセットボタンを押しても正常に初期状態がロードされること。

## 3.6. 神経衰弱デッキ表示テスト
1.  **Game Library**から「神経衰弱」を選択し「Apply」。
2.  **Deck / Rule**ボタンを開く。
3.  **確認点**:
    *   [ ] カード一覧に S-A〜S-8, H-A〜H-8 の16枚が表示されていること。

## 5. ババ抜き機能 (Phase 5)
1.  **開始テスト**:
    *   Hostで「ババ抜き開始」を押す。
    *   [ ] 全員の手札が配られ、自動でペアが捨てられる。
    *   [ ] 画面がババ抜き専用モード（緑の背景）に切り替わる。
2.  **プレイテスト**:
    *   [ ] 手番プレイヤーのみ「Draw from Left」ボタンが出る。
    *   [ ] ボタンを押すとカードが移動し、ペアがあれば捨てられる。
    *   [ ] ターンが次の人に移る。
3.  **終了テスト**:
    *   [ ] 手札がなくなると「WINNER」表示になる。
    *   [ ] 最後の一人になると「GAME OVER」になり、敗者が確定する。

## 4. 安定性チェック
*   [ ] AIが考え中に、チャットやダイスを連打してもサーバーが落ちない。
*   [ ] AIの回答待ち中に、別の操作（カードを出すなど）ができる。

## 6. Render ルーム作成デバッグ（Phase 4.5）
本番環境での「Room Creation Failed」の原因特定のため、ログ機能とエラー表示を強化しました。

1.  **デプロイ後の確認**:
    *   Renderのダッシュボードで Server サービスがデプロイ完了となっていることを確認。
    *   Logsタブを開いておく。

2.  **ルーム作成テスト**:
    *   本番URLを開き「ホストとして始める」をクリック。
    *   成功すれば、通常通りルームに入室。
    *   **Logs確認**: `[create_room] Success: XXXXXX` のようなログが出ていること。

3.  **エラーハンドリング確認** (失敗する場合):
    *   画面にアラートで「作成に失敗しました: [詳細なエラー内容]」が表示される。
    *   **Logs確認**: `[create_room] Failed:` に続くエラーログを確認し、Prisma接続エラーかタイムアウトかを特定する。

すべてクリアできれば、Phase 4 の実装は完了です！
