
# ボードゲーム会場 MVP (Board Game Venue MVP) - 現在のステータス

## 1. 直近の状況 (Current Status: Mix Juice Debugging)

ユーザー報告を受け、**「ミックスジュース」モードにおける『あなたのターンではありません』エラーの解消**に取り組んでいます。

### 発生している問題
- **現象**: 2人プレイ時、ホストが1ターン目に「チェンジ」を選択すると、サーバーから「あなたのターンではありません」というエラーが返され、進行不能になる。
- **再現性**: ローカル環境（再現スクリプト）では現象を再現できず、正常に動作する。
- **推測**: 本番環境において、特定のタイミングで「手番プレイヤー情報（turnSeat）」と「参加者リスト」の整合性が崩れている可能性がある。

### 対応内容 (v6.1 DEBUG)
本番環境での原因特定と、プレイ続行を可能にするため、以下の修正を行いました。

1.  **強力な自動修復ロジックの実装**:
    - アクションを実行しようとしたプレイヤーが「手番リスト（turnSeat）」に含まれていない場合、**即座にリストを再構築**して修復するように変更しました。
    - これにより、内部データが破損していても、プレイヤーが操作した瞬間に正常な状態へ復帰します。

2.  **デバッグ情報の可視化**:
    - エラーメッセージを詳細化しました。
    - `あなたの番ではありません (T:xxxx Y:yyyy I:0)`
        - `T`: サーバーが認識している手番プレイヤーID（末尾4桁）
        - `Y`: 操作を行ったあなたのID（末尾4桁）
        - `I`: 現在のターンインデックス
    - これにより、誰のターンだと誤認されているかが一目で分かります。

3.  **バージョン表示**:
    - 画面右上に「**v6.1 DEBUG**」という表示を追加しました。これが表示されていれば、最新の修正が適用されています。

## 2. 実装済み機能 (Implemented Features)

### ゲームモード
- **Tabletop (テーブルトップ)**: 自由操作モード。
- **Old Maid (ババ抜き)**: 自動配布、ペア破棄、ターン制ドロー。
- **Mix Juice (ミックスジュース)**:
    - **ルール**: カードの数値を足し合わせるサバイバルゲーム。「0」のカードでドボン。
    - **アクション**: パス、チェンジ（手札交換）、冷蔵庫（全交換）。
    - **UI**: 自分の手番で「チェンジ」などのアクションボタンが表示される。アニメーション強化済み。

### システム
- **Game Library**: ルールセットの保存・適用機能。
- **Room**: 入室管理、観戦モード切り替え。
- **Deployment**: Render.com への自動デプロイ設定済み。

## 3. 次のアクション (Next Steps)
1.  ユーザーに「v6.1 DEBUG」環境でプレイしていただく。
2.  エラーが解消されたか、または詳細なエラーコード（T:xxxx...）が表示されるかを確認する。
3.  問題が解決していれば、デバッグ表示を削除してクローズとする。
